<div class="form-container">
  <h2 class="form-title">Negociación y Priorización</h2>
  <p class="form-subtitle">Determinar qué requerimientos se implementarán primero</p>

  <!-- Mensaje de éxito -->
  <div class="alert alert-success" *ngIf="showSuccess">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
      <path d="M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM8 15L3 10L4.41 8.59L8 12.17L15.59 4.58L17 6L8 15Z" fill="currentColor"/>
    </svg>
    <span>{{ successMessage }}</span>
  </div>

  <!-- Información -->
  <div class="alert alert-info mb-lg">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
      <path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z"/>
    </svg>
    <div>
      <strong>Justificación (Pressman):</strong> No todos los requerimientos pueden realizarse al mismo tiempo. 
      Es necesario priorizarlos según su importancia y viabilidad.
    </div>
  </div>

  <!-- Estadísticas rápidas -->
  <div class="stats-grid mb-lg">
    <div class="stat-card">
      <div class="stat-number">{{ requerimientos.length }}</div>
      <div class="stat-label">Total Requerimientos</div>
    </div>
    <div class="stat-card stat-high">
      <div class="stat-number">{{ getRequerimientosPorPrioridad('Alta').length }}</div>
      <div class="stat-label">Prioridad Alta</div>
    </div>
    <div class="stat-card stat-medium">
      <div class="stat-number">{{ getRequerimientosPorPrioridad('Media').length }}</div>
      <div class="stat-label">Prioridad Media</div>
    </div>
    <div class="stat-card stat-success">
      <div class="stat-number">{{ getRequerimientosAceptados().length }}</div>
      <div class="stat-label">Aceptados</div>
    </div>
  </div>

  <!-- Botón para agregar requerimiento -->
  <div class="mb-lg flex justify-between items-center">
    <h3 class="text-xl font-semibold">Lista de Requerimientos</h3>
    <button 
      type="button" 
      class="btn btn-primary"
      (click)="showAddForm = !showAddForm"
    >
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12h14"/>
      </svg>
      Agregar Requerimiento
    </button>
  </div>

  <!-- Formulario para agregar requerimiento -->
  <div class="card mb-lg" *ngIf="showAddForm">
    <div class="card-body">
      <h4 class="card-title">Nuevo Requerimiento</h4>
      
      <div class="form-group">
        <label class="form-label" for="nombre">Nombre del Requerimiento*</label>
        <input 
          type="text" 
          id="nombre"
          name="nombre"
          [(ngModel)]="nuevoRequerimiento.nombre"
          class="form-input"
          placeholder="Ej: Sistema de autenticación de usuarios"
        />
      </div>

      <div class="form-group">
        <label class="form-label" for="descripcion">Descripción*</label>
        <textarea 
          id="descripcion"
          name="descripcion"
          [(ngModel)]="nuevoRequerimiento.descripcion"
          class="form-textarea"
          placeholder="Describe el requerimiento..."
          rows="3"
        ></textarea>
      </div>

      <div class="form-group">
        <label class="form-label" for="prioridad">Prioridad*</label>
        <select 
          id="prioridad"
          name="prioridad"
          [(ngModel)]="nuevoRequerimiento.prioridad"
          class="form-select"
        >
          <option value="" disabled>Selecciona prioridad</option>
          <option value="Alta">Alta</option>
          <option value="Media">Media</option>
          <option value="Baja">Baja</option>
        </select>
      </div>

      <div class="form-group">
        <label class="flex items-center gap-sm cursor-pointer">
          <input 
            type="checkbox"
            [(ngModel)]="nuevoRequerimiento.aceptado"
            class="checkbox"
          />
          <span>Marcar como aceptado</span>
        </label>
      </div>

      <div class="flex gap-sm">
        <button 
          type="button" 
          class="btn btn-primary"
          (click)="agregarRequerimiento()"
          [disabled]="!isNuevoRequerimientoValid()"
        >
          Agregar
        </button>
        <button 
          type="button" 
          class="btn btn-ghost"
          (click)="showAddForm = false; resetNuevoRequerimiento()"
        >
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla de requerimientos -->
  <div class="card" *ngIf="requerimientos.length > 0">
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th class="table-th">Requerimiento</th>
            <th class="table-th">Prioridad</th>
            <th class="table-th text-center">Aceptado</th>
            <th class="table-th text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let req of requerimientos" class="table-row">
            <td class="table-td">
              <div class="req-info">
                <div class="req-name">{{ req.nombre }}</div>
                <div class="req-desc">{{ req.descripcion }}</div>
              </div>
            </td>
            <td class="table-td">
              <select 
                [(ngModel)]="req.prioridad"
                (change)="actualizarPrioridad(req.id!, req.prioridad)"
                class="priority-select"
                [ngClass]="{
                  'priority-high': req.prioridad === 'Alta',
                  'priority-medium': req.prioridad === 'Media',
                  'priority-low': req.prioridad === 'Baja'
                }"
              >
                <option value="Alta">Alta</option>
                <option value="Media">Media</option>
                <option value="Baja">Baja</option>
              </select>
            </td>
            <td class="table-td text-center">
              <label class="checkbox-container">
                <input 
                  type="checkbox"
                  [(ngModel)]="req.aceptado"
                  (change)="actualizarAceptado(req.id!, req.aceptado)"
                  class="checkbox"
                />
              </label>
            </td>
            <td class="table-td text-center">
              <button 
                type="button"
                class="btn-icon btn-danger"
                (click)="eliminarRequerimiento(req.id!)"
                title="Eliminar"
              >
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 6h14M8 6V4h4v2m-5 0v7m4-7v7M5 6l1 11h8l1-11"/>
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Estado vacío -->
  <div class="empty-state" *ngIf="requerimientos.length === 0">
    <svg width="64" height="64" fill="none" stroke="currentColor" stroke-width="1">
      <rect x="8" y="8" width="48" height="48" rx="4"/>
      <path d="M8 20h48M20 8v48M28 28h8M28 36h8"/>
    </svg>
    <h3>No hay requerimientos</h3>
    <p>Agrega el primer requerimiento para comenzar la negociación</p>
    <button 
      type="button" 
      class="btn btn-primary"
      (click)="showAddForm = true"
    >
      Agregar Requerimiento
    </button>
  </div>

  <!-- Botones de acción -->
  <div class="actions-bar" *ngIf="requerimientos.length > 0">
    <button 
      type="button" 
      class="btn btn-outline"
      (click)="exportarJSON()"
    >
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
      </svg>
      Exportar JSON
    </button>
    <button 
      type="button" 
      class="btn btn-primary"
      (click)="guardarCambios()"
    >
      Guardar Cambios
    </button>
  </div>

</div>